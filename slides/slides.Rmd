---
title: "Extend The Functionality Of</br>Your R Markdown Document"
author: "Christophe Dervieux"
date: 08/07/2021 - userR! 2021
output:
  xaringan::moon_reader:
    lib_dir: libs
    chakra: libs/remark-latest.min.js
    css: [useR, custom.sass]
    nature:
      # scale and scaleh
      beforeInit: "macros.js"
      highlightLines: true
      # highlightStyle: solarized-light
---

```{r xaringan-tachyons, echo=FALSE}
xaringanExtra::use_tachyons()
xaringanExtra::use_tile_view()
xaringanExtra::use_panelset()
library(texPreview)

# will be used several times in a cat engine
temp_file <- tempfile()
# setting option for the several cat engine
knitr::opts_template$set(cat_md = list(
  engine.opts = list(file = temp_file, lang = "markdown"),
  echo = TRUE
))
# clean tempfile after a chunk computation
knitr::knit_hooks$set(rm_temp = function(before) {
  if (!before) unlink(temp_file)
})

```

# About me

.center[

.profile[![:scale 25%](https://avatars.githubusercontent.com/u/6791940?v=4)]

Software Engineer at RStudio 

R Markdown Team

First Time Raukr Speaker

]
</br></br>  
.pull-left[
.center[
`r fontawesome::fa("github")`
[@cderv](https://github.com/cderv)
]
]

.pull-right[
.center[
`r fontawesome::fa("twitter")`
[@chrisderv](https://twitter.com/chrisderv)
]
]

???

---
# What are we talking today ? 

.pull-left.center[
![:scale 80%](https://pkgs.rstudio.com/rmarkdown/reference/figures/logo.png)
.f6[https://pkgs.rstudio.com/rmarkdown/]
]
.pull-right.center[
![:scale 70%](https://bookdown.org/yihui/rmarkdown-cookbook/images/cover.png)
.f6[https://bookdown.org/yihui/rmarkdown-cookbook/]
]

???

Everyone should know rmarkdown among R users. Its principle has not changed since a long time 
(md + R = Rmd -> output format) quite easy to start (write text, add code chunk, compile) but it can be harder to learn new skill to be more efficient and get full power. 

That is where known recipes can help master more advanced skills. R Markdown Cookbook was thought as a non linear documentation

---
layout: true

# What happens when it renders ?

---

.center[![:scale 100%, R Markdown wizard illustration by Alison Horst](https://raw.githubusercontent.com/allisonhorst/stats-illustrations/master/rstats-artwork/rmarkdown_wizards.png)]
.source-fig.center[
Source: https://github.com/allisonhorst/stats-illustrations
]

???

We often see these rmarkdown little wizard mixing Text & Code to produce document. Aim is to look deeper into this today. This is not so magic.

---

.center[![:scale 80%, Diagram showing the different step of rendering, using knitr first from Rmd to md, then Pandoc from md to output format like HTML, DOC and PDF (using LaTeX)](https://bookdown.org/yihui/rmarkdown-cookbook/images/workflow.png)]
.source-fig[
source: [R Markdown Cookbook](https://bookdown.org/yihui/rmarkdown-cookbook)
]

.box.f3[`knitr::knit()` + Pandoc (+ LaTeX for PDF)</br> = `rmarkdown::render()`]

???

This is important to know so that one understand what to tweak to make something works

---
layout: true
# A simple default report

---

![](simple-report.gif)

.source-fig[
Source file link
]

---


![](simple-report-html.gif)

.source-fig[
Source file link
]

---
layout: false

# Do not show code output 

.subtitle[knitr options]

````markdown
```{r setup, include=FALSE}`r ''`
# do not show code by default
knitr::opts_chunk$set(echo = FALSE)
```
````
* Chunk will be evaluated but no output or source included.
* Do not show the source chunk as code block. Set globally here

---

# Add alternative text

.subtitle[About `fig.alt` chunk option]

.panelset[

.panel[.panel-name[With images]
````markdown
```{r, out.width='60%', fig.align = 'center', echo = FALSE, 
*fig.alt = "Illustration of pinguins species : 
*Chinstrap, Gentoo and Ad√©lia"}`r ''`
knitr::include_graphics("https://allisonhorst.github.io/
palmerpenguins/reference/figures/lter_penguins.png")
```
````
]

.panel[.panel-name[With R plots]
````markdown
```{r, include = FALSE}`r ''`
island_repart_alt <- "Horizontal bar chart, faceted by Species showing the number of penguins living on each island, Torgersen, Dream and Biscoe. Adelie lives on the three, whereas Gentoo on Biscoe and Chinstrap on Dream."
```

*```{r island-repart, fig.alt= island_repart_alt}`r ''`
ggplot(penguins, aes(x = island, fill = species)) +
  geom_bar(alpha = 0.8) +
  scale_fill_manual(values = c("darkorange","purple","cyan4"),
                    guide = FALSE) +
  theme_minimal() +
  facet_wrap(~species, ncol = 1) +
  coord_flip()
```
````
```````
]
]

---
layout: true
# Style the output (1)

.subtitle[About the `css` engine]

---

````markdown
```{css, echo = FALSE}`r ''`
/* header in blue */
h1, h2, h3 {
  color: #0A7FB2
}
```
````

Applied directly in the Rmd document without an external css file. 

???

Useful with few CSS like with examples or prototyping for instance.
echo = false is important if you don't want to show CSS source chunk in output


---

or using external file : 

````yaml
output:
  html_document:
    css: mystyle.css
````

Better suited to share style across documents.

???

---
layout: true
# Highlight results

.subtitle[Using Custom Blocks]

---

This is powered by [Pandoc's Fenced Divs](https://pandoc.org/MANUAL.html#divs-and-spans) syntax:

```{cat, opts.label ='cat_md'}
::: {.highlight-box style="text-align: center;font-size: 1.5em;"}
The **`r heaviest_specie`** specie is heavier than other ! 
:::
```

---

```{r demo-box, echo = FALSE, results='asis', rm_temp = TRUE}
o <- tempfile()
rmarkdown::pandoc_convert(temp_file, to = "html", output = I(o))
content <- xfun::read_utf8(o)
unlink(o)
```

This will be rendered in HTML

```{cat, engine.opts = list(lang = "html"), code = content}
```

---
layout: true
# Style the output (2)

---

.subtitle[How to improve our highlighted results ?]


> I want to .color1[**add a border**] to create a box and .color1[**apply my blue color**].

Can I use variable for my color and not repeat myself ? 

---

.subtitle[Using SASS]

.center[![:scale 25%](https://sass-lang.com/assets/img/logos/logo-b6e1ef6e.svg)]

Sass (https://sass-lang.com) is a CSS extension language that allows you to create CSS rules in much more flexible ways than you would do with plain CSS.

???

It allows for variables, tweaking functions (called _mixins_), operations (like `/`), better CSS rule organisation (nesting, extensions, ...) and more.

---

.subtitle[Using SASS... from R]

.center[

![:scale 20%](https://rstudio.github.io/sass/reference/figures/logo.svg)</br>.f3[https://rstudio.github.io/sass/]
]

.box[Support is now built-in</br> **rmarkdown**]

---

.panelset[

.panel[.panel-name[css]

````markdown
```{css, echo = FALSE}`r ''`
* h1, h2, h3 {color: #0A7FB2;}

div.highlight-box {
* border-color: #0A7FB2;
  border-style: solid;
  padding: 0.5em;
}

div.highlight-box strong {
* color: #0A7FB2;
}
```
````

]

.panel[.panel-name[scss]
````markdown
```{scss, echo = FALSE}`r ''`
*$color1: #0A7FB2; /* using a variable */

*h1, h2, h3 {color: $color1;}

div { /* using nested organization */
  &.highlight-box { 
*   border-color: $color1;
    border-style: solid;
    padding: 0.5em;

    strong {
*     color: $color1;
    }
  }
}
```
````

]
.panel[.panel-name[sass]

````markdown
```{sass, echo = FALSE}`r ''`
$color1: #0A7FB2

h1, h2, h3
  color: $color1

div
  &.highlight-box
    border-color: $color1
    border-style: solid
    padding: 0.5em
  
    strong
      color: $color1
```
````

]
]

???

_sass_ syntax is shorter (no `;` and `{ }`) but more different from _css_ than _scss_, so less easy to get started.

In this example and the previous _scss_ one, we are using special _SASS_ features like [Nesting](https://sass-lang.com/documentation/style-rules/declarations#nesting) and [Parent Selector](https://sass-lang.com/documentation/style-rules/parent-selector).

This allows organization of CSS rules for easier reading and modifications. 


---
layout: false
# A enhanced report

![](simple-report-enhanced-html.gif)

.source-fig[
Source file link
]

---

# How to go further ?

.subtitle[and enhanced even more your Rmd !]

.center[

More in the book

![:scale 35%](https://bookdown.org/yihui/rmarkdown-cookbook/images/cover.png)

.f4[https://bookdown.org/yihui/rmarkdown-cookbook/]

]

---
class: center middle

# Thank you !

---
class: annexe

# Acknowledgement

```{r, include = FALSE}
gh_handle_to_link <- function(handle) sprintf("[@%s](https://github.com/%s)", handle, handle)
```


* Emily Riederer and Yihui Xie, for the R Markdown Cookbook
* Allison Horst for the illustrations.
* Alison Presman-Hill and Allison Horst for the **palmerpinguins** `r emo::ji("package")` and vignettes.
* `r gh_handle_to_link("cpsievert")` for the [**sass**](https://rstudio.github.io/sass/) `r emo::ji("package")`
